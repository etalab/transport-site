<section class="section section-white">
  <div class="container">
    <h2>Laissez-nous votre avis</h2>
    <form action="#" method="post" name="form" target="_blank" novalidate="" class="no-margin">
      <div class="form__group feedback-selector">
        <fieldset>
          <legend class="required">Qu’avez vous pensé de cette page ?</legend>

          <input type="radio" id="like" name="feedback-rating" value="like" />
          <label class="label-inline" for="like"><i class="fa-regular fa-face-smile feedback-emojis"></i></label>
          <input type="radio" id="neutral" name="feedback-rating" value="neutral" />
          <label class="label-inline" for="neutral"><i class="fa-regular fa-face-meh feedback-emojis"></i></label>
          <input type="radio" id="dislike" name="feedback-rating" value="dislike" />
          <label class="label-inline" for="dislike"><i class="fa-regular fa-face-frown feedback-emojis"></i></label>
        </fieldset>
      </div>

      <div id="full-feedback-form" class="hidden">
        <div class="form__group">
          <label for="feedback-text" class="required">Pourquoi ?</label>
          <textarea name="feedback-text"></textarea>
        </div>

        <div class="form__group">
          <label for="feedback-email">Votre email (facultatif)</label>
          <input id="feedback-email" name="feedback-email" required="" type="email" />
        </div>

        <button class="button" type="submit" name="subscribe" id="submit">Envoyer l’avis</button>
      </div>
    </form>
    <script>
      document.querySelectorAll(".feedback-selector label").forEach(
        function(el) {
        el.addEventListener('click', function() {
          document.getElementById("full-feedback-form").classList.remove("hidden");
        });
       }
      );
    </script>
  </div>
</section>

<section class="single-page section section-grey">
  <div class="container container_min_height">
    <h1><%= TransportWeb.Gettext.dgettext("validations", "Check the quality of a file or a feed") %></h1>
    <div class="pb-48">
      <.form
        :let={f}
        for={@changeset}
        action={validation_path(@socket, :validate)}
        class="no-margin"
        multipart={true}
        as={:upload}
        phx-change="form_changed"
        phx-trigger-action={@trigger_submit}
      >
        <%= select(f, :type, @select_options, label: dgettext("validations", "Data type"), required: true) %>
        <%= if @input_type == "file" do %>
          <%= file_input(f, :file, label: dgettext("validations", "Choose your file"), required: true) %>
        <% end %>
        <%= if @input_type == "link" do %>
          <%= text_input(f, :url,
            label: dgettext("validations", "Your URL"),
            placeholder: "https://.../gbfs.json",
            required: true,
            type: "url"
          ) %>
        <% end %>
        <%= if @input_type == "gtfs-rt" do %>
          <%= text_input(f, :url,
            label: dgettext("validations", "Your GTFS' URL"),
            placeholder: "https://example.com/gtfs.zip",
            required: true,
            type: "url"
          ) %>
          <%= text_input(f, :feed_url,
            label: dgettext("validations", "Your GTFS realtime's URL"),
            placeholder: "https://example.com/gtfs-rt.bin",
            required: true,
            type: "url"
          ) %>
        <% end %>
        <%= unless @input_type == "file" or @type == "netex" do %>
          <%= submit(dgettext("validations", "Validate"), nodiv: true) %>
        <% end %>
      </.form>
      <p :if={@trigger_submit} class="small">
        <%= TransportWeb.Gettext.dgettext("validations", "Upload in progress") %>
      </p>
      <div :if={@type == "netex"} class="container section section-grey" id="netex-explanations">
        <p>
          <%= raw(
            TransportWeb.Gettext.dgettext("validations", "netex-siri-validator", link: "https://greenlight.atomite.io")
          ) %>
        </p>

        <p>
          <%= raw(
            TransportWeb.Gettext.dgettext("validations", "doc-eu-formats",
              link: "https://doc.transport.data.gouv.fr/documentation/normes-europeennes"
            )
          ) %>
        </p>
      </div>
    </div>
  </div>
</section>

<script defer type="text/javascript" src={static_path(@socket, "/js/app.js")} />
