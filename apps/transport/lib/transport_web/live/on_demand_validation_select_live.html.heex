<section class="single-page section section-grey">
  <div class="container container_min_height">
    <h1><%= dgettext("validations", "Check the quality of a file or a feed") %></h1>
    <div class="pb-48">
      <div class="available-data grid">
        <a
          :for={{type, item} <- @tiles}
          class={if @selected_tile == type, do: "tile tile-colored", else: "tile"}
          phx-click="select_tile"
          phx-value-tile={type}
        >
          <img class="tile__icon" src={item.icon} alt={item.title} />
          <div class="tile__text">
            <h4><%= item.title %></h4>
            <div><%= item.subtitle %></div>
          </div>
        </a>
      </div>

      <%= for {identifier, item} <- @tiles do %>
        <div :if={@selected_tile == identifier} class="container available-data grid pt-24 pb-48">
          <a
            :for={{title, type} <- item.sub_tiles}
            href="#form_anchor"
            class={if @selected_subtile == type, do: "tile tile-colored", else: "tile sub_tile"}
            phx-click="select_subtile"
            phx-value-tile={type}
          >
            <img class="tile__icon" src={icon(type)} alt="" />
            <div class="tile__text">
              <h4><%= title %></h4>
            </div>
          </a>
        </div>
      <% end %>

      <div id="form_anchor"></div>
      <.form
        :let={f}
        :if={@selected_subtile}
        for={%{}}
        action={validation_path(@socket, :validate)}
        class="no-margin"
        multipart={true}
        as={:upload}
        phx-change="form_changed"
        phx-trigger-action={@trigger_submit}
      >
        <%= hidden_input(f, :type, value: @type) %>
        <%= if @input_type == "file" do %>
          <%= file_input(f, :file, label: dgettext("validations", "Choose your file"), required: true) %>
        <% end %>
        <%= if @input_type == "link" do %>
          <%= text_input(f, :url,
            label: dgettext("validations", "Your URL"),
            placeholder: "https://.../gbfs.json",
            required: true,
            type: "url",
            value: @url
          ) %>
        <% end %>
        <%= if @input_type == "gtfs-rt" do %>
          <%= text_input(f, :url,
            label: dgettext("validations", "Your GTFS' URL"),
            placeholder: "https://example.com/gtfs.zip",
            required: true,
            type: "url",
            value: @url
          ) %>
          <%= text_input(f, :feed_url,
            label: dgettext("validations", "Your GTFS realtime's URL"),
            placeholder: "https://example.com/gtfs-rt.bin",
            required: true,
            type: "url",
            value: @feed_url
          ) %>
        <% end %>
        <%= unless @input_type == "file" do %>
          <%= submit(dgettext("validations", "Validate"), nodiv: true) %>
        <% end %>
      </.form>
      <p :if={@trigger_submit} class="small">
        <%= dgettext("validations", "Upload in progress") %>
      </p>
    </div>
  </div>
</section>

<section class="section section-white">
  <%= live_render(@socket, TransportWeb.Live.FeedbackLive,
    id: "feedback-form",
    session: %{"feature" => "on_demand_validation"}
  ) %>
</section>
